<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FinanceSim â€“ Investment Hub</title>
  <link rel="stylesheet" href="homestyle.css" />
  <link rel="stylesheet" href="aicss.css" />
  <style>
    /* Collapsible company buttons */
    .company-btn {
      width: 100%;
      text-align: left;
      background-color: #f0f0f0;
      border: none;
      padding: 8px;
      margin: 4px 0;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .company-panel {
      display: none;
      border: 1px solid #ccc;
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 6px;
      background-color: #fafafa;
    }
    .company-panel input {
      width: 100px;
    }
    .row { display: flex; align-items: center; justify-content: space-between; }
    .stack { display: flex; flex-direction: column; gap: 6px; }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="brand">FinanceSim</div>
    <div class="nav-links">
      <a href="sell.html">Sell Assets</a>
      <a href="index.html">Home</a>
    </div>
  </nav>

  <div class="container">
    <div class="summary">
      <div class="item">Year: <span id="year" class="val">2020</span></div>
      <div class="item">Cash: $<span id="cash" class="val">10,000.00</span></div>
    </div>

    <h1>Choose Assets to Buy</h1>
    <div class="panel">
      <h3 style="margin-top:0;">Available Assets</h3>

      <!-- Savings Account -->
      <div class="panel" style="margin-top:8px;">
        <div class="row" style="justify-content:space-between; align-items: baseline;">
          <div>
            <strong>Savings Account</strong>
            <div class="muted">Interest: 0.4% (0.004)</div>
          </div>
          <div>
            Balance: $<span id="savings" class="val">0.00</span>
          </div>
        </div>
        <div class="stack" style="margin-top:10px;">
          <div class="field">
            <label for="saveAmount"><strong>Deposit amount</strong></label>
            <input id="saveAmount" type="number" class="input" placeholder="1000" />
          </div>
          <div class="row">
            <button class="btn btn-success" onclick="saveMoney()">Deposit</button>
          </div>
        </div>
      </div>

      <!-- Certificates of Deposit -->
      <div class="panel" style="margin-top:16px;">
        <div class="row" style="justify-content:space-between; align-items: baseline;">
          <div>
            <strong>Certificates of Deposit (CDs)</strong>
            <div class="muted">Rates vary by term</div>
          </div>
          <div>
            <span id="cdSummary">No active CDs</span>
          </div>
        </div>
        <div class="stack" style="margin-top:10px;">
          <div class="field">
            <label for="cdAmount"><strong>Invest amount</strong></label>
            <input id="cdAmount" type="number" class="input" placeholder="1000" />
          </div>
          <div id="cdOptions" class="row" style="flex-wrap: wrap; gap: 8px; margin-top:8px;"></div>
        </div>
      </div>

      <!-- Stocks -->
      <div class="panel" style="margin-top:16px;">
        <div>
          <strong>Stocks</strong>
          <div class="muted">Invest in companies</div>
        </div>
        <div id="stocksList" style="margin-top:8px;"></div>
      </div>

      <div class="row" style="justify-content:space-between; margin-top:12px;">
        <button class="btn btn-secondary" onclick="window.location.href='sell.html'">Go to Sell Assets</button>
        <button id="next-year-btn" class="btn btn-primary" onclick="nextYear()">Next Year</button>
      </div>
    </div>
  </div>

  <script>
    // ======= State =======
    const savingsRate = 0.004; 
    let currentYear = 2020;
    let cash = 10000;
    let savings = 0;
    let cds = [];

    // Stocks
    let companies = [
      { name: "Company A", value: 0, returnRate: 0.06 },
      { name: "Company B", value: 0, returnRate: 0.05 },
      { name: "Company C", value: 0, returnRate: 0.08 }
    ];

    const cdRates = {
      2020: {1: 0.02, 2: 0.025, 3: 0.03, 5: 0.044},
      2021: {1: 0.023, 2: 0.03, 3: 0.036},
      2022: {1: 0.026, 2: 0.033, 3: 0.04},
      2023: {1: 0.029, 2: 0.037},
      2024: {1: 0.036}
    };

    const round2 = (n) => Math.round((Number(n)+Number.EPSILON)*100)/100;
    const clean = (n) => { const x = round2(n); return Math.abs(x) < 0.005 ? 0 : x; };

    function normalizeState() {
      cash = clean(cash);
      savings = clean(savings);
      cds = cds.map(cd => ({ ...cd, amount: clean(cd.amount) }));
      companies = companies.map(c => ({ ...c, value: clean(c.value) }));
    }

    // ======= Persistence =======
    function loadData() {
      cash = parseFloat(localStorage.getItem("balance")) || 10000;
      savings = parseFloat(localStorage.getItem("savings")) || 0;
      currentYear = parseInt(localStorage.getItem("year")) || 2020;
      cds = JSON.parse(localStorage.getItem("cds") || "[]");
      const savedCompanies = JSON.parse(localStorage.getItem("companies") || "[]");
      if(savedCompanies.length) companies = savedCompanies.map(c => ({ ...c }));
      normalizeState();
    }

    function saveData() {
      normalizeState();
      localStorage.setItem("balance", cash);
      localStorage.setItem("savings", savings);
      localStorage.setItem("year", currentYear);
      localStorage.setItem("cds", JSON.stringify(cds));
      localStorage.setItem("companies", JSON.stringify(companies));
    }

    // ======= UI =======
    function formatMoney(val) {
      return clean(val).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
    }

    function updateUI() {
      document.getElementById("year").textContent = currentYear;
      document.getElementById("cash").textContent = formatMoney(cash);
      document.getElementById("savings").textContent = formatMoney(savings);

      // CDs
      const cdOpts = cdRates[currentYear] || {};
      const cdOptionsDiv = document.getElementById("cdOptions");
      cdOptionsDiv.innerHTML = "";
      Object.entries(cdOpts).forEach(([term, rate]) => {
        const btn = document.createElement("button");
        btn.className = "btn btn-success";
        btn.textContent = `${term} Yr @ ${(rate*100).toFixed(1)}%`;
        btn.onclick = () => investCD(parseInt(term), rate);
        cdOptionsDiv.appendChild(btn);
      });

      const cdSummaryEl = document.getElementById("cdSummary");
      cdSummaryEl.innerHTML = cds.length
        ? cds.map(cd => `Balance: $${formatMoney(cd.amount)} | Mature Year: ${cd.maturityYear}`).join("<br>")
        : "No active CDs";

      // Stocks
      const stocksListDiv = document.getElementById("stocksList");
      stocksListDiv.innerHTML = "";
      companies.forEach((c, idx) => {
        const btn = document.createElement("button");
        btn.className = "company-btn";
        btn.textContent = `${c.name} - $${formatMoney(c.value)}`;
        btn.onclick = () => {
          const panel = btn.nextElementSibling;
          panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        };
        const panel = document.createElement("div");
        panel.className = "company-panel";
        panel.innerHTML = `
          <input type="number" placeholder="Amount" id="invest-${idx}" />
          <button class="btn btn-success" onclick="investStock(${idx})">Invest</button>
        `;
        stocksListDiv.appendChild(btn);
        stocksListDiv.appendChild(panel);
      });

      // Next year button
      const nextBtn = document.getElementById("next-year-btn");
      if (currentYear >= 2025) {
        nextBtn.textContent = "Review Final Assets";
        nextBtn.onclick = () => window.location.href = 'sell.html';
      } else {
        nextBtn.textContent = "Next Year";
        nextBtn.onclick = nextYear;
      }
    }

    // ======= Actions =======
    function saveMoney() {
      let amount = parseFloat(document.getElementById("saveAmount").value);
      if (isNaN(amount) || amount <= 0) return;
      amount = clean(amount);
      if (amount > cash) { alert("Not enough cash!"); return; }
      cash -= amount;
      savings += amount;
      saveData();
      document.getElementById("saveAmount").value = "";
      updateUI();
    }

    function investCD(term, rate) {
      let amount = parseFloat(document.getElementById("cdAmount").value);
      if (isNaN(amount) || amount <= 0) return;
      amount = clean(amount);
      if (amount > cash) { alert("Not enough cash!"); return; }
      cash -= amount;
      cds.push({
        amount: amount,
        rate: rate,
        yearsLeft: term,
        maturityYear: currentYear + term
      });
      saveData();
      document.getElementById("cdAmount").value = "";
      updateUI();
    }

    function investStock(idx) {
      const input = document.getElementById(`invest-${idx}`);
      let amount = parseFloat(input.value);
      if (isNaN(amount) || amount <= 0) return;
      amount = clean(amount);
      if (amount > cash) { alert("Not enough cash!"); return; }
      cash -= amount;
      companies[idx].value += amount;
      saveData();
      input.value = "";
      updateUI();
    }

    function nextYear() {
      if (currentYear >= 2025) return;
      currentYear++;
      savings *= (1 + savingsRate);
      cds.forEach(cd => {
        cd.amount *= (1 + cd.rate);
        cd.yearsLeft--;
        if(cd.yearsLeft <= 0) cash += cd.amount;
      });
      cds = cds.filter(cd => cd.yearsLeft > 0);
      companies.forEach(c => c.value *= (1 + c.returnRate));
      saveData();
      updateUI();
    }

    // ======= Init =======
    loadData();
    updateUI();
  </script>
</body>
</html>
