<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FinanceSim â€“ Investment Hub</title>
  <link rel="stylesheet" href="homestyle.css" />
  <link rel="stylesheet" href="aicss.css" />
</head>
<body>
  <nav class="nav">
    <div class="brand">FinanceSim</div>
    <div class="nav-links">
      <a href="sell.html">Sell Assets</a>
      <a href="index.html">Home</a>
    </div>
  </nav>

  <div class="container">
    <!-- Top summary bar: Year + Cash -->
    <div class="summary">
      <div class="item">Year: <span id="year" class="val">2020</span></div>
      <div class="item">Cash: $<span id="cash" class="val">10,000.00</span></div>
    </div>

    <h1>Choose Assets to Buy</h1>
    <div class="panel">
      <h3 style="margin-top:0;">Available Assets</h3>

      <!-- Asset: Savings Account -->
      <div class="panel" style="margin-top:8px;">
        <div class="row" style="justify-content:space-between; align-items: baseline;">
          <div>
            <strong>Savings Account</strong>
            <div class="muted">Interest: 0.4% (0.004)</div>
          </div>
          <div>
            Balance: $<span id="savings" class="val">0.00</span>
          </div>
        </div>

        <div class="stack" style="margin-top:10px;">
          <div class="field">
            <label for="saveAmount"><strong>Deposit amount</strong></label>
            <input id="saveAmount" type="number" class="input" placeholder="1000" />
          </div>
          <div class="row">
            <button class="btn btn-success" onclick="saveMoney()">Deposit</button>
          </div>
        </div>
      </div>

      <!-- Asset: Certificates of Deposit -->
      <div class="panel" style="margin-top:16px;">
        <div class="row" style="justify-content:space-between; align-items: baseline;">
          <div>
            <strong>Certificates of Deposit (CDs)</strong>
            <div class="muted">Rates vary by term</div>
          </div>
          <div>
            <span id="cdSummary">No active CDs</span>
          </div>
        </div>

        <div class="stack" style="margin-top:10px;">
          <div class="field">
            <label for="cdAmount"><strong>Invest amount</strong></label>
            <input id="cdAmount" type="number" class="input" placeholder="1000" />
          </div>
          <div id="cdOptions" class="row" style="flex-wrap: wrap; gap: 8px; margin-top:8px;"></div>
        </div>
      </div>

      <div class="row" style="justify-content:space-between; margin-top:12px;">
        <button class="btn btn-secondary" onclick="window.location.href='sell.html'">Go to Sell Assets</button>
        <button id="next-year-btn" class="btn btn-primary" onclick="nextYear()">Next Year</button>
      </div>
    </div>
  </div>

  <script>
    // ======= State =======
    const savingsRate = 0.004; // 0.4% yearly
    let currentYear = 2020;
    let cash = 10000;
    let savings = 0;
    // Each CD: {amount, rate, yearsLeft, maturityYear}
    let cds = [];

    // CD rates by year
    const cdRates = {
      2020: {1: 0.02, 2: 0.025, 3: 0.03, 5: 0.044},
      2021: {1: 0.023, 2: 0.03, 3: 0.036},
      2022: {1: 0.026, 2: 0.033, 3: 0.04},
      2023: {1: 0.029, 2: 0.037},
      2024: {1: 0.036}
    };

    // ======= Precision helpers (round everything to cents) =======
    const round2 = (n) => Math.round((Number(n) + Number.EPSILON) * 100) / 100;
    const clean  = (n) => {
      const x = round2(n);
      return Math.abs(x) < 0.005 ? 0 : x; // avoid -0.00
    };

    function normalizeState() {
      cash    = clean(cash);
      savings = clean(savings);
      cds = cds.map(cd => ({ ...cd, amount: clean(cd.amount) }));
    }

    // ======= Persistence =======
    function loadData() {
      cash = parseFloat(localStorage.getItem("balance")) || 10000;
      savings = parseFloat(localStorage.getItem("savings")) || 0;
      currentYear = parseInt(localStorage.getItem("year")) || 2020;
      cds = JSON.parse(localStorage.getItem("cds") || "[]");
      normalizeState();
    }
    function saveData() {
      normalizeState();
      localStorage.setItem("balance", cash);
      localStorage.setItem("savings", savings);
      localStorage.setItem("year", currentYear);
      localStorage.setItem("cds", JSON.stringify(cds));
    }

    // ======= UI =======
    function formatMoney(val) {
      return (clean(val)).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    function updateUI() {
      document.getElementById("year").textContent = currentYear;
      document.getElementById("cash").textContent = formatMoney(cash);
      document.getElementById("savings").textContent = formatMoney(savings);

      // Render CD buttons for the current year
      const cdOpts = cdRates[currentYear] || {};
      const cdOptionsDiv = document.getElementById("cdOptions");
      cdOptionsDiv.innerHTML = "";
      Object.entries(cdOpts).forEach(([term, rate]) => {
        const btn = document.createElement("button");
        btn.className = "btn btn-success";
        btn.textContent = `${term} Yr @ ${(rate*100).toFixed(1)}%`;
        btn.onclick = () => investCD(parseInt(term, 10), rate);
        cdOptionsDiv.appendChild(btn);
      });

      // CD summary
      const cdSummaryEl = document.getElementById("cdSummary");
      if (cds.length === 0) {
        cdSummaryEl.textContent = "No active CDs";
      } else {
        cdSummaryEl.innerHTML = cds.map(cd =>
          `Current Balance: $${formatMoney(cd.amount)} | Mature Year: ${cd.maturityYear}`
        ).join("<br>");
      }

      // Next year button
      const nextBtn = document.getElementById("next-year-btn");
      if (currentYear >= 2025) {
        nextBtn.textContent = "Review Final Assets";
        nextBtn.onclick = () => window.location.href = 'sell.html';
      } else {
        nextBtn.textContent = "Next Year";
        nextBtn.onclick = nextYear;
      }
    }

    // ======= Actions =======
    function saveMoney() {
      let amount = parseFloat(document.getElementById("saveAmount").value);
      if (isNaN(amount) || amount <= 0) return;
      amount = clean(amount);
      if (amount > cash) { alert("Not enough cash!"); return; }
      cash    = clean(cash - amount);
      savings = clean(savings + amount);
      saveData();
      document.getElementById("saveAmount").value = "";
      updateUI();
    }

    function investCD(term, rate) {
      let amount = parseFloat(document.getElementById("cdAmount").value);
      if (isNaN(amount) || amount <= 0) return;
      amount = clean(amount);
      if (amount > cash) { alert("Not enough cash!"); return; }
      cash = clean(cash - amount);
      cds.push({
        amount: amount,
        rate: rate,
        yearsLeft: parseInt(term, 10),
        maturityYear: currentYear + parseInt(term, 10)
      });
      saveData();
      document.getElementById("cdAmount").value = "";
      updateUI();
    }

    function nextYear() {
      if (currentYear >= 2025) return;
      currentYear++;

      // Savings interest (round to cents)
      savings = clean(savings * (1 + savingsRate));

      // CDs compound annually, then reduce term; matured CDs pay out to cash
      cds.forEach(cd => {
        cd.amount = clean(cd.amount * (1 + cd.rate));
        cd.yearsLeft -= 1;
        if (cd.yearsLeft === 0) {
          cash = clean(cash + cd.amount);
        }
      });
      cds = cds.filter(cd => cd.yearsLeft > 0);

      saveData();
      updateUI();
    }

    // ======= Init =======
    loadData();
    updateUI();
  </script>
</body>
</html>
